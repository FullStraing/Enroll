{% extends "ui/base.html" %}
{% load static %}

{% block page_title %}Common App Draft{% endblock %}
{% block page_heading %}Common App Draft{% endblock %}
{% block page_subtitle %}Generate draft responses per section. AI is currently a stub.{% endblock %}

{% block content %}
  <section class="card">
    <div class="card-title">
      <img src="{% static 'icons/common-app.svg' %}" alt="" />
      <h2>Common App Draft</h2>
    </div>
    <label for="commonapp-section">Section</label>
    <select id="commonapp-section">
      <option value="personal_info">Personal info</option>
      <option value="activities">Activities</option>
      <option value="honors">Honors</option>
      <option value="education">Education</option>
      <option value="writing">Writing</option>
    </select>
    <label for="commonapp-input">Your notes</label>
    <textarea id="commonapp-input" placeholder="Write key points for this section"></textarea>
    <div class="form-actions">
      <button id="generate-commonapp">Generate draft</button>
    </div>
    <div id="commonapp-status" class="status info"></div>
    <label for="commonapp-output">Draft output</label>
    <textarea id="commonapp-output" readonly></textarea>
  </section>
{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const api = window.api;
      if (!api || !api.request) {
        console.error("API helpers not loaded.");
        return;
      }
      const { request, setStatus } = api;

      async function generateDraft() {
        const status = document.getElementById("commonapp-status");
        const output = document.getElementById("commonapp-output");
        setStatus(status, "Generating draft...");
        try {
          const payload = {
            section: document.getElementById("commonapp-section").value,
            notes: document.getElementById("commonapp-input").value.trim(),
          };
          const data = await request("/api/ai/commonapp-draft/", {
            method: "POST",
            body: JSON.stringify(payload),
          });
          output.value = JSON.stringify(data, null, 2);
          setStatus(status, "Draft generated (stub).", "success");
        } catch (error) {
          output.value = "";
          setStatus(status, error.message, "error");
        }
      }

      document.getElementById("generate-commonapp").addEventListener("click", generateDraft);
    });
  </script>
{% endblock %}
