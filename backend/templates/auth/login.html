<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Вход — Enroll AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-[#0B0F19] text-white">
    <main class="mx-auto flex min-h-screen max-w-xl flex-col justify-center px-6 py-12">
      <div class="mb-8">
        <h1 class="text-3xl font-semibold tracking-wide">Enroll AI</h1>
        <p class="mt-2 text-sm text-slate-300">Войти в рабочее пространство.</p>
      </div>
      <div class="rounded-2xl border border-[rgba(255,255,255,0.08)] bg-[rgba(255,255,255,0.04)] p-6">
        <label class="text-xs font-semibold text-slate-300">Username</label>
        <input id="login-username" class="mt-2 w-full rounded-lg border border-slate-700 bg-transparent px-3 py-2 text-sm text-white" />
        <label class="mt-4 block text-xs font-semibold text-slate-300">Password</label>
        <input id="login-password" type="password" class="mt-2 w-full rounded-lg border border-slate-700 bg-transparent px-3 py-2 text-sm text-white" />
        <button id="login-btn" class="mt-6 w-full rounded-lg bg-[#A78BFA] px-4 py-2 text-sm font-semibold text-[#120826] shadow-[0_0_18px_rgba(167,139,250,0.5)] transition hover:shadow-[0_0_28px_rgba(167,139,250,0.7)]">
          Войти
        </button>
        <p id="login-status" class="mt-3 text-xs text-slate-300"></p>
      </div>
      <div class="mt-6 text-sm text-slate-300">
        Нет аккаунта? <a class="text-[#22D3EE] underline" href="/register">Создать аккаунт</a>
      </div>
    </main>
    <script>
      const tokenKey = "enroll_token";
      const statusEl = document.getElementById("login-status");

      function setStatus(text, isError = false) {
        statusEl.textContent = text;
        statusEl.className = isError ? "mt-3 text-xs text-red-300" : "mt-3 text-xs text-slate-300";
      }

      async function login() {
        setStatus("Входим...");
        try {
          const payload = {
            username: document.getElementById("login-username").value.trim(),
            password: document.getElementById("login-password").value,
          };
          const response = await fetch("/api/auth/token/", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          if (!response.ok) {
            const err = await response.json();
            throw new Error(err.detail || JSON.stringify(err));
          }
          const data = await response.json();
          localStorage.setItem(tokenKey, data.access);
          window.location.href = "/dashboard/";
        } catch (error) {
          setStatus(error.message, true);
        }
      }

      document.getElementById("login-btn").addEventListener("click", login);
    </script>
  </body>
</html>
